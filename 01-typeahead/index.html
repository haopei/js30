<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>

    <style media="screen">
        .highlight {
            background: yellow;
        }
    </style>

    </head>
    <body>

        <input type="text" name="search" value="" class="search">
        <div class="suggestions"></div>


        <script>
            const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

            const cities = [];

            fetch(endpoint)
                .then(resp => resp.json())
                .then(data => cities.push(...data) );


            /**
             * Returns cities matching the keyword
             * @param  {str} wordToMatch [keyword to search for]
             * @param  {array} cities [the cities to search through]
             * @return {[array]} [list of cities with keyword in it]
             */
            function findMatches(wordToMatch, cities) {
                return cities.filter(place => {
                    const regex = new RegExp(wordToMatch, 'gi');
                    return place.city.match(regex) || place.state.match(regex);
                })
            }

            function displayMatches() {
                // this.value is the value of the search input
                const matches = findMatches(this.value, cities);
                const html = matches.map(place => {
                    const regex = new RegExp(this.value, 'gi');
                    const cityName = place.city.replace(regex, `<span class="highlight">${this.value}</span>`);
                    const stateName = place.state.replace(regex, `<span class="highlight">${this.value}</span>`);
                    return `
                        <li>
                            <span class="name">${cityName}, ${stateName}</span>
                            <span class="population">${place.population}</span>
                        </li>
                    `
                }).join('');
                console.log(html);
                suggestions.innerHTML = html;
            }

            const searchInput = document.querySelector('.search');
            const suggestions = document.querySelector('.suggestions');

            // searchInput.addEventListener('change', displayMatches)
            searchInput.addEventListener('keyup', displayMatches)


        </script>
    </body>
</html>
